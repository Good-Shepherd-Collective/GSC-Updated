<!-- src/components/global/InlineEmail.astro -->
<div class="w-full bg-gray-100 py-4 px-6 pb-10 border border-zinc-600 rounded-md">
    <div class="mx-auto max-w-md space-y-2">
      <div class="space-y-2 text-left">
        <p class="text-lg mb-10 font-semibold" style="font-family: sans-serif">Critical updates</p>
      </div>
      <form 
        id="newsletterForm" 
        action="https://hello.goodshepherdcollective.org/sendy/subscribe" 
        method="POST" 
        accept-charset="utf-8" 
        class="space-y-4"
      >
        <!-- Hidden inputs for Sendy -->
        <input type="hidden" name="list" value="y89212UBuNheyECx7v9tOdrQ"/>
        <input type="hidden" name="subform" value="yes"/>
        
        <!-- form steps here -->
        <div id="step1" class="form-step active">
          <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <label class="sr-only" for="name">Name</label>
            <input
              class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
              id="name"
              name="name"
              placeholder="Your Name"
              type="text"
              required
            />
            <div class="flex gap-4">
              <button
                class="mt-4 sm:mt-0 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-black text-white hover:bg-gray-800 h-10 px-4 py-2"
                type="button"
                onclick="nextStep()"
              >
                Next
              </button>
            </div>
          </div>
        </div>
        <div id="step2" class="form-step">
          <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <label class="sr-only" for="email">Email</label>
            <input
              class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
              id="email"
              name="email"
              placeholder="m@example.com"
              type="email"
              required
            />
            <div class="flex gap-4">
              <button
                class="mt-4 sm:mt-0 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-black text-white hover:bg-gray-800 h-10 px-4 py-2"
                type="button"
                onclick="previousStep()"
              >
                Previous
              </button>
              <button
                class="mt-4 sm:mt-0 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-black text-white hover:bg-gray-800 h-10 px-4 py-2"
                type="button"
                onclick="nextStep()"
              >
                Next
              </button>
            </div>
          </div>
        </div>
        <div id="step3" class="form-step">
          <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <label class="sr-only" for="state">State</label>
            <input
              class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
              id="state"
              name="state"
              placeholder="Your State"
              type="text"
              required
            />
            <div class="flex gap-4">
              <button
                class="mt-4 sm:mt-0 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-black text-white hover:bg-gray-800 h-10 px-4 py-2"
                type="button"
                onclick="previousStep()"
              >
                Previous
              </button>
              <button
                class="mt-4 sm:mt-0 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-black text-white hover:bg-gray-800 h-10 px-4 py-2"
                type="button"
                onclick="nextStep()"
              >
                Next
              </button>
            </div>
          </div>
        </div>
        <div id="step4" class="form-step">
          <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <label class="sr-only" for="gdpr">GDPR Consent</label>
            <input
              class="mr-2"
              type="checkbox"
              id="gdpr"
              name="gdpr"
              required
            />
            <span class="text-sm">I give my consent to Good Shepherd Collective to be in touch with me via email using the information I have provided in this form for the purpose of news, updates and marketing.</span>
          </div>
          <div class="flex flex-col sm:flex-row items-center justify-between gap-4 mt-4">
            <button
              class="mt-4 sm:mt-0 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-black text-white hover:bg-gray-800 h-10 px-4 py-2"
              type="button"
              onclick="previousStep()"
            >
              Previous
            </button>
            <button
              class="mt-4 sm:mt-0 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-black text-white hover:bg-gray-800 h-10 px-4 py-2"
              type="submit"
            >
              Submit
            </button>
          </div>
        </div>
        <div id="formError" class="hidden text-red-500 text-center"></div>
      </form>
    </div>
  </div>
  
  <style>
    .form-step {
      display: none;
    }
    .form-step.active {
      display: block;
    }
  </style>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const steps = document.querySelectorAll('.form-step');
      let currentStep = 0;
  
      function showStep(index) {
        steps.forEach((step, i) => {
          step.classList.toggle('active', i === index);
        });
      }
  
      window.nextStep = function() {
        const form = document.getElementById('newsletterForm');
        const name = (form.querySelector('#name') as HTMLInputElement).value.trim();
        const email = (form.querySelector('#email') as HTMLInputElement).value.trim();
        const state = (form.querySelector('#state') as HTMLInputElement).value.trim();
        const gdpr = (form.querySelector('#gdpr') as HTMLInputElement).checked;
        const errorDiv = document.getElementById('formError');
  
        if (currentStep === 0 && !name) {
          errorDiv.textContent = 'Name is required.';
          errorDiv.classList.remove('hidden');
          return;
        } else if (currentStep === 1 && !email) {
          errorDiv.textContent = 'Email is required.';
          errorDiv.classList.remove('hidden');
          return;
        } else if (currentStep === 1) {
          // Additional email validation
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(email)) {
            errorDiv.textContent = 'Please enter a valid email address.';
            errorDiv.classList.remove('hidden');
            return;
          }
        } else if (currentStep === 2 && !state) {
          errorDiv.textContent = 'State is required.';
          errorDiv.classList.remove('hidden');
          return;
        } else if (currentStep === 3 && !gdpr) {
          errorDiv.textContent = 'Consent is required.';
          errorDiv.classList.remove('hidden');
          return;
        }
  
        errorDiv.classList.add('hidden');
        errorDiv.textContent = '';
  
        if (currentStep < steps.length - 1) {
          currentStep++;
          showStep(currentStep);
        } else {
          // Allow form submission to Sendy
          (form as HTMLFormElement).submit();
        }
      };
  
      window.previousStep = function() {
        if (currentStep > 0) {
          currentStep--;
          showStep(currentStep);
        }
      };
  
      showStep(currentStep);
    });
  </script>
  