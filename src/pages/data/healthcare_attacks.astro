---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { fetchHealthAttackData } from "src/utils/health_care.js";

// Fetch the data
const healthAttackData = await fetchHealthAttackData();

// Helper function to format date as mm.dd.yyyy
function formatDateMMDDYYYY(dateString) {
  const date = new Date(dateString);
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const year = date.getFullYear();
  return `${month}.${day}.${year}`;
}

// Sort the data by date (most recent first)
healthAttackData.sort((a, b) => new Date(b.Date) - new Date(a.Date));

// Get the most recent date
const mostRecentDate = healthAttackData.length > 0 ? formatDateMMDDYYYY(healthAttackData[0].Date) : 'N/A';

---

<BaseLayout
  isBlogPost={true}
  title="Attacks on Healthcare"
  description="Report of attacks on healthcare in the West Bank and Gaza."
>
  <section class="md:px-12 sm:px-8">
    <div class="border-x border-zinc-800 p-8">
      <div style="max-width: 55rem; margin: 0 auto;">
        <h1
          class="text-4xl md:text-6xl xl:text-7xl font-semibold"
          style="margin-bottom: 2.5rem; margin-top: 4.5rem;"
        >
          Attacks on healthcare 
        </h1>
        <h2 class="text-2xl mb-4 highlight-red">Structures of violence</h2>
        <p>
          This section provides data on attacks on healthcare facilities and workers.
        </p>
        <h3 class="text-2xl font-semibold mt-8 text-zinc-800">Data as of {mostRecentDate}</h3>
        
        <div class="table-container">
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr class="header border-y border-zinc-800">
                  <th>Date</th>
                  <th>Event Description</th>
                  <th>Perpetrator</th>
                  <th>Weapon Used</th>
                  <th>Location</th>
                  <th>Health Facilities Destroyed</th>
                  <th>Health Facilities Damaged</th>
                  <th>Access Denied/Obstructed</th>
                  <th>Health Workers Killed</th>
                  <th>Health Workers Injured</th>
                  <th>Health Workers Kidnapped</th>
                  <th>Health Workers Arrested</th>
                  <th>Location Accuracy</th>
                </tr>
              </thead>
              <tbody>
                {healthAttackData.map((item) => (
                  <tr>
                    <td>{formatDateMMDDYYYY(item.Date)}</td>
                    <td>{item['Event Description']}</td>
                    <td>{item['Reported Perpetrator Name']}</td>
                    <td>{item['Weapon Carried/Used']}</td>
                    <td>{item['Location of Incident']}</td>
                    <td>{item['Number of Attacks on Health Facilities Reporting Destruction']}</td>
                    <td>{item['Number of Attacks on Health Facilities Reporting Damaged']}</td>
                    <td>{item['Access Denied or Obstructed']}</td>
                    <td>{item['Health Workers Killed']}</td>
                    <td>{item['Health Workers Injured']}</td>
                    <td>{item['Health Workers Kidnapped']}</td>
                    <td>{item['Health Workers Arrested']}</td>
                    <td>{item['Geo Precision']}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
        
        <p class="pt-8">
          
           <a href="/data_sheets/healthcare_attacks.csv"
            download="healthcare_attacks.csv">Download as CSV</a
          >&nbsp;|&nbsp;
          
           <a href="/data_sheets/healthcare_attacks.xlsx"
            download="healthcare_attacks.xlsx">Download as Excel</a
          >
          &nbsp;|&nbsp;
          
           <a href="/api/healthcare_attacks.json"
            >.JSON endpoint</a
          >
        </p>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .table-container {
    margin-top: 2rem;
    border: 1px solid #ddd;
  }
  .table-scroll {
    overflow: auto;
    max-height: 500px; /* Adjust this value as needed */
  }
  .data-table {
    border-collapse: collapse;
    width: 100%;
  }
  .data-table th, .data-table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
    white-space: nowrap;
    text-wrap: wrap;
  }
  .data-table th {
    background-color: #f2f2f2;
    font-weight: bold;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  .data-table tr:nth-child(even) {
    background-color: #f9f9f9;
  }
  .data-table tr:hover {
    background-color: #f5f5f5;
  }
</style>