---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getGazaDestructionData } from "@/utils/gaza-destruction.js";
import { processDemolitionData } from "@/utils/home_demolitions.js";


const gazaDestructionData = await getGazaDestructionData();
const gazaDestructionDate = gazaDestructionData.formattedGazaDestructionDate;

const demolitionData = await processDemolitionData();
console.log("Processed Demolition Data:", demolitionData);

if (!demolitionData || !Array.isArray(demolitionData.chartData)) {
  throw new Error("Home demolitions data is not an array or is invalid");
}

const homeDemolitionsData = demolitionData.chartData;
const newestDemolitionDate = demolitionData.newestDateofincident;
console.log("Newest Demolition Date:", newestDemolitionDate);

const formattedNewestDemolitionDate = (() => {
  const date = new Date(newestDemolitionDate);
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const year = date.getFullYear();
  return `${month}.${day}.${year}`;
})();

---

<BaseLayout
  isBlogPost={true}
  title="Demolition Data Report"
  description="Demolition data report for the specified region."
>
  <section class="md:px-12 sm:px-8">
    <div class="border-x border-zinc-200 p-8">
      <div style="max-width: 55rem; margin: 0 auto;">
        <h1
          class="text-4xl md:text-6xl xl:text-7xl font-semibold"
          style="margin-bottom: 2.5rem; margin-top: 4.5rem;"
        >
          Data Sets
        </h1>
        <h2 class="text-2xl mb-4 highlight-red">Here are some of the critical data points for your advocacy</h2>
        
        <h3 class="text-2xl font-semibold mt-8 text-zinc-800">Data for </h3>
        
        <table class="data-table">
          <thead>
            <tr class="header border-y border-zinc-800">
              <th class="table-title mr-4">Category</th>
              <th class="wide-table-columan mr-4">Details</th>
              <th class="average">Updated</th>
              <th class="average table-icon ">CSV</th>
              <th class="average table-icon ">Excel</th>
              <th class="average table-icon ">API</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td data-cell="Category" class="py-4">
                <a href="data/gaza_destruction" class="flex items-center space-x-2">
                  <p>Gaza Destruction</p>
                  <img class="copy-icon" style="filter:invert(1)" src="/images/Arrow.svg" alt="Arrow Icon">
                </a>
              </td>
              <td data-cell="Details" class="value py-4">
                This dataset provides a broad overview of the structural damage as a result of the ongoing genocide in Gaza.
              </td>
              <td data-cell="Updated" class="average py-4" id="Gaza_destruction">{gazaDestructionDate}</td>
              <td data-cell="CSV" class="average py-4"><a href="/data_sheets/gaza_destruction_report.csv"><img class="hide-on-mobile" src="/images/black-download.svg"><p class="mobile-only">Download</p></a></td>
              <td data-cell="Excel" class="average py-4"><a href="/data_sheets/gaza_destruction_report.xlsx"><img class="hide-on-mobile" src="/images/black-download.svg"><p class="mobile-only">Download</p></a></td>
              <td data-cell="API" class="average py-4 last"><a href="https://data.techforpalestine.org/api/v3/infrastructure-damaged.json"><img class="hide-on-mobile" src="/images/Json.svg"><p class="mobile-only">Link</p></a></td>
            </tr>
            <tr>
              <td data-cell="Category" class="py-4">
                <a href="data/home_demolitions" class="flex items-center space-x-2">
                  <p>Home Demolitions</p>
                  <img class="copy-icon" style="filter:invert(1)" src="/images/Arrow.svg" alt="Arrow Icon">
                </a>
              </td>
              
              <td data-cell="Details" class="value py-4">
                This dataset provides a summary of home demolitions of East Jerusalem and the West Bank.
              </td>
              <td data-cell="Updated" class="average py-4" id="DemolitionDate">{formattedNewestDemolitionDate}</td>
              <td data-cell="CSV" class="average py-4"><a href="/data_sheets/demolition_data_report.csv"><img class="hide-on-mobile" src="/images/black-download.svg"><p class="mobile-only">Download</p></a></td>
              <td data-cell="Excel" class="average py-4"><a href="/data_sheets/demolition_data_report.xlsx"><img class="hide-on-mobile" src="/images/black-download.svg"><p class="mobile-only">Download</p></a></td>
              <td data-cell="API" class="average py-4 last"><a href="/api/home_demolitions.json"><img class="hide-on-mobile" src="/images/Json.svg"><p class="mobile-only">Link</p></a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>
</BaseLayout>
